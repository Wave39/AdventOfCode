//
//  Puzzle_2025_07.swift
//  AdventOfCode
//
//  Created by Brian Prescott on 11/28/25.
//  Copyright Â© 2025 Wave 39 LLC. All rights reserved.
//

import Foundation

public class Puzzle_2025_07: PuzzleBaseClass {
    public func solve() {
        let part1 = solvePart1()
        print("Part 1 solution: \(part1)")

        let part2 = solvePart2()
        print("Part 2 solution: \(part2)")
    }

    public func solvePart1() -> Int {
        solvePart1(str: Puzzle_Input.final)
    }

    public func solvePart2() -> Int {
        solvePart2(str: Puzzle_Input.final)
    }

    private func solvePart1(str: String) -> Int {
        var grid = getCharacterGrid(str: str)
        var splitCount = 0
        for row in 1..<grid.count {
            for col in 0..<grid[row].count {
                let char = grid.characterAtCoordinates(col, row)
                let charAbove = grid.characterAtCoordinates(col, row - 1)
                if char == "^" && charAbove == "|" {
                    splitCount += 1
                    grid.setCharacterAtCoordinates(col - 1, row, "|")
                    grid.setCharacterAtCoordinates(col + 1, row, "|")
                } else if char == "." && (charAbove == "|" || charAbove == "S") {
                    grid.setCharacterAtCoordinates(col, row, "|")
                }
            }
        }

        return splitCount
    }

    func countTimelines(grid: [[Character]]) -> Int {
        let rows = grid.count
        let cols = grid[0].count

        var start = Point2D.origin
        outer: for r in 0..<rows {
            for c in 0..<cols {
                if grid[r][c] == "S" {
                    start = Point2D(x: c, y: r)
                    break outer
                }
            }
        }

        var memo = Array(
            repeating: Array(repeating: Int?.none, count: cols),
            count: rows
        )

        func dfs(_ r: Int, _ c: Int) -> Int {
            if r == rows - 1 {
                return 1          // next step exits the manifold
            }

            if let cached = memo[r][c] {
                return cached
            }

            let below = grid[r + 1][c]
            let result: Int

            if below == "." || below == "S" {
                // straight down
                result = dfs(r + 1, c)
            } else { // below == "^"
                var total = 0

                // left branch
                if c == 0 {
                    total += 1
                } else {
                    total += dfs(r + 1, c - 1)
                }

                // right branch
                if c == cols - 1 {
                    total += 1
                } else {
                    total += dfs(r + 1, c + 1)
                }

                result = total
            }

            memo[r][c] = result
            return result
        }

        return dfs(start.y, start.x)
    }

    private func solvePart2(str: String) -> Int {
        let arr = str.parseIntoCharacterMatrix()
        let retval = countTimelines(grid: arr)
        return retval
    }
}

private class Puzzle_Input: NSObject {
    static let test = """
.......S.......
...............
.......^.......
...............
......^.^......
...............
.....^.^.^.....
...............
....^.^...^....
...............
...^.^...^.^...
...............
..^...^.....^..
...............
.^.^.^.^.^...^.
...............
"""

    static let final = """
......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.....^...................................................................
.............................................................................................................................................
..................................................................^...^...^..................................................................
.............................................................................................................................................
.................................................................^...^...^.^.................................................................
.............................................................................................................................................
................................................................^.^.^...^.^.^................................................................
.............................................................................................................................................
...............................................................^...^.^.^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^.^.^.^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^.^.....^.....^.^.............................................................
.............................................................................................................................................
............................................................^.....^.^...^.^.^...^............................................................
.............................................................................................................................................
...........................................................^.^.^.........^.^.^...^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^.^.....^...^.^.^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^.^.^...^.^...^.^.........................................................
.............................................................................................................................................
........................................................^.^.^.......^.^.^.....^.^.^.^........................................................
.............................................................................................................................................
.......................................................^.^.....^...^.^.^.^.^.^.^.^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^...^.^.^.^...^...^.^...^.^......................................................
.............................................................................................................................................
.....................................................^.^.^...^.^...^.^.......^...^.^.^.^.....................................................
.............................................................................................................................................
....................................................^.^.^...^.^.^.^.^...^.^...^.^...^.^.^....................................................
.............................................................................................................................................
...................................................^.^.^...^...^.^...^.^.^.^.^.^.^.....^.^...................................................
.............................................................................................................................................
..................................................^...^.^...^.^.....^.^.^.....^.^.^.^.^.^.^..................................................
.............................................................................................................................................
.................................................^.^.^.^.^...^...^.^.^.......^.^.......^.^.^.................................................
.............................................................................................................................................
................................................^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.^...^.^.^................................................
.............................................................................................................................................
...............................................^.^.^...^.^.^...........^.^.^.^.^.^.^.....^.^.^...............................................
.............................................................................................................................................
..............................................^.^.....^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.^.^.^..............................................
.............................................................................................................................................
.............................................^.^.^.^...^...^...^.^...^.......^...^.^.^.^.^.^...^.............................................
.............................................................................................................................................
............................................^.....^.^.^.....^.^.^.^.^.^...^.^.^.......^...^.^.^.^............................................
.............................................................................................................................................
...........................................^.^...^.....^...^...^.........^.....^.^.^...^.^.^.^.^.^...........................................
.............................................................................................................................................
..........................................^.^.^.^.^.^.^.^...^.^.^.^.^...^...^.^...^.^.^.^.^.^.^.^.^..........................................
.............................................................................................................................................
.........................................^.^...^.^.^.....^.^.^.^...^.....^...^.^.^.........^...^.^.^.........................................
.............................................................................................................................................
........................................^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^...^.....^.^.^.^.....^........................................
.............................................................................................................................................
.......................................^.^.^.^.^.^.^.^.^.^.^...^.^.....^.^.^.....^.^...^.^.^.^...^.^.^.......................................
.............................................................................................................................................
......................................^...^.^.^.^.^...^.^.^.^...^.^.^.^...^.^.^...^.^.^...^.....^.....^......................................
.............................................................................................................................................
.....................................^...^.^.^.^.^.^...^.^.^.^...^.....^.^.^.......^...^.^.....^.....^.^.....................................
.............................................................................................................................................
....................................^.....^...^.^.^.^.^...^.^.....^.^.^...^...^.^...^.^...^...^...^.^.^.^....................................
.............................................................................................................................................
...................................^.^.^...^...^.^.^.^.^.^.^.^.^...^.......^.^.^.^.^...^.^.^.^.^.^...^.^.^...................................
.............................................................................................................................................
..................................^.^.^.^.^.^.^...^.^...^.....^...^...^.^...^...^.^.^...^.^...............^..................................
.............................................................................................................................................
.................................^.^.^.^...^.^.^.^.......^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.....^.^...^.................................
.............................................................................................................................................
................................^.^...^...^.^...^.^...^.^.....^.^.^.^.^.^...^.^.^.....^...^...^.^.^.^.^.....^................................
.............................................................................................................................................
...............................^.......^.^.^.^.......^.........^...^.^.^.^.^...^.^.^...^...^.^...^.^.^.^.^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^.^.^.^.....^...^.^.^...^.^...^.^.^...^.^.^.^.^...........^...^...^.^.^...^..............................
.............................................................................................................................................
.............................^...^.^.......^.^.^.^.^.^.^.^.^.^.^.^...^...^.....^.^.^.^.^.^...^.^.^...^.^.^...^.^.............................
.............................................................................................................................................
............................^...^...^...^...^.^.^.^...^.^.....^.^.^...^.^.^.^.^.^.....^.^.^...^.............^...^............................
.............................................................................................................................................
...........................^...^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^...^.^...........................
.............................................................................................................................................
..........................^.^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.^.^.^.^.....^.^...^...^.^.^.^.^...^...^.^...^...^.^..........................
.............................................................................................................................................
.........................^...^...^.^.^...^.....^.^.^.^.^.^.^.^.^.^...^.....^.^.^...^.^...^.^.^...^...^...^.^.^.^...^.........................
.............................................................................................................................................
........................^.^.^...^.^...^...^...^.^.^.^.^...^.^...^.^.....^.^.^.^.^.....^...^.....^.^.......^.^.^.^.^.^........................
.............................................................................................................................................
.......................^.^.^.^.^.....^.^...^.^.^.^.^.^.^.....^.^.......^.^.^.^...^...^.^...^...^.^.^.^.^.^...^.^.^.^.^.......................
.............................................................................................................................................
......................^.^.^.^...^.^.....^.^.^.^.^.^...^...^...^...^.^.^...^...^.^...^...^.^.^...^.^...^.^.^.^.^...^.^.^......................
.............................................................................................................................................
.....................^...^.^.....^...^...^.^.^.^.^...^.^.^.^.^.....^...^.^.^.....^.^.^...^.^.^...^.......^.^...^...^.^.^.....................
.............................................................................................................................................
....................^.^.^.^...^.^.^...^.^.^.^.^.^...^.^.^.....^.^.^...^.^.^...^.^.^.^.......^.^.^...^.^.^.^.^.^.^.^.^.^.^....................
.............................................................................................................................................
...................^.^.^.........^.^.^...^.^.....^.^...^.....^.^...^...^...^.^.^.^.^...^.^...^...^...^.^...^.^.^.^.^.^.^.^...................
.............................................................................................................................................
..................^...^.^...^...^.^...^.^.^.^...^.^.^.^.^.^.^.^.^...^...^.^.^.....^.^.^.....^.^...^.....^...^...^.^.^.^.^.^..................
.............................................................................................................................................
.................^.^.^...^...^.........^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^.^.^.^.^.^.^.....^.^.^.................
.............................................................................................................................................
................^...^.^.....^.^.^.......^...^.......^.^.^.........^.^.^.^...^.^.^.^.^.^.^.^.........^...^.^.^.^.^.^.^.^.^.^.^................
.............................................................................................................................................
...............^.^.^.^.^.^.^...^.^...^.^.^.^.^...^.^.^.^...^.^.^.^.^.^.^...^.^.....^.............^.^.^.^.^.^.....^.^.^.^.....^...............
.............................................................................................................................................
..............^...^.^...^.^.......^.^.^.^.^...^...^.^.^.^.....^.^.^.^.^...^.^.^...^.^.^...^.^...^...^.^...^.......^.^.^.^.^.^.^..............
.............................................................................................................................................
.............^.^.^.^.^...^.^.....^.^...^.^...^.........^...^.^.^.....^.^.....^.^.^.^.^.^.^.^.^...^.^...^...^.^.^...^.^.^.^...^.^.............
.............................................................................................................................................
............^.^.^.^...^.............^.^.^.....^...^...^...^.^.^.^.^.^.^...^.^.^.^...^.^...^.^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.^............
.............................................................................................................................................
...........^.^...^...^.^...^...^...^...^...^...^...^...^.^.^.^...^.....^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.....^.^...^...........
.............................................................................................................................................
..........^.^.^.^.........^.^.^.^.....^.^.^.^.^.^.^.^...^.^.^.^...^.^.^...^.^.^.....^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.........^...^..........
.............................................................................................................................................
.........^.^.^.^.^.^...^.^...^.^...^.^.^.^...^...^...^.^.^.....^.^.......^.^.^.^.^.^.........^.^.^.........^.....^.^.^.....^.^...^.^.........
.............................................................................................................................................
........^.^.^...^.^...^...^.^...^.^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^...^.^.^.....^.....^...^.^.....^.......^.....^........
.............................................................................................................................................
.......^.^.^...^...^.^.^...^.^.^.....^...^...^.......^.^.......^.^...^.^.^...^.^.^.^.^.^...^.^...^.^...^.^.^.^...^.^.^.^.^...^.^...^.^.......
.............................................................................................................................................
......^.^...^.^.^.^.^.....^.^.^.........^.^.^.^.^.....^.^.^.^...^.^.^.^.^.^.^.^.^...^.^.^.....^.^.^...^.^.^...^.........^.....^.^.^...^......
.............................................................................................................................................
.....^.....^.^.^.^.....^.^...^.^.....^...^.^.^.^.^.^.........^...^.^.^...^.^...^.^.^.^.^.^.^.^.^...^.^.^.^.....^...^.....^...^.....^...^.....
.............................................................................................................................................
....^...^...^.^.^...^.^...^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.....^.....^.^.^.........^.^.^.^...^.^.^...^.^.^.^.^.^.^....
.............................................................................................................................................
...^.^.^.^.^.^.^.^.^...^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.^...^.....^...^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.....^...
.............................................................................................................................................
..^.^.....^.^.^.^.^.....^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^...^.^.^.^.^.^...^...^.^.^...^.^...^.^.^.^.....^.....^.^..
.............................................................................................................................................
.^.^.....^...^...^.^.^.^.^.^.^.......^.^.^.^.^.^.....^.^.^.^.^...^.......^.^...^.^...^.^...^.^.^.^...^...^.^.......^.....^.^.^.^.....^...^.^.
.............................................................................................................................................
"""
}
